<!--pages/test-staff/test-staff.wxml-->
<view class="container">
  <view class="test-content">
    <text class="title">ğŸ¼ äº”çº¿è°±å›¾ç‰‡æµ‹è¯•</text>
    
    <!-- å›¾ç‰‡ä¸‹è½½çŠ¶æ€ -->
    <view class="download-info">
      <text class="info-text">å›¾ç‰‡ä¸‹è½½çŠ¶æ€ï¼š{{imageDownloadStatus.isCompleted ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}</text>
      <text class="info-text" wx:if="{{imageDownloadStatus.error}}">é”™è¯¯ï¼š{{imageDownloadStatus.error}}</text>
      <text class="info-text">æ€»å›¾ç‰‡æ•°é‡ï¼š{{totalCount}} å¼ </text>
    </view>

    <!-- è°±å·åˆ‡æ¢ -->
    <view class="clef-filter">
      <text class="section-title">è°±å·è¿‡æ»¤</text>
      <view class="clef-options">
        <view 
          class="clef-option {{currentClef === 'treble' ? 'active' : ''}}"
          bindtap="switchClef"
          data-clef="treble"
        >
          é«˜éŸ³ç¬¦å· ({{trebleCount}})
        </view>
        <view 
          class="clef-option {{currentClef === 'bass' ? 'active' : ''}}"
          bindtap="switchClef"
          data-clef="bass"
        >
          ä½éŸ³ç¬¦å· ({{bassCount}})
        </view>
        <view 
          class="clef-option {{currentClef === 'all' ? 'active' : ''}}"
          bindtap="switchClef"
          data-clef="all"
        >
          å…¨éƒ¨ ({{totalCount}})
        </view>
      </view>
    </view>

    <!-- å½“å‰éŸ³ç¬¦ä¿¡æ¯ -->
    <view class="current-note" wx:if="{{currentNote}}">
      <text class="note-title">å½“å‰éŸ³ç¬¦ï¼š{{currentNote.name}} ({{currentNote.clef === 'treble' ? 'é«˜éŸ³' : 'ä½éŸ³'}}ç¬¦å·)</text>
      <text class="note-info">è°±å·ï¼š{{currentNote.clef === 'treble' ? 'é«˜éŸ³ç¬¦å·' : 'ä½éŸ³ç¬¦å·'}}</text>
      <text class="note-info">ä½ç½®ï¼š{{currentNote.position}}</text>
      <text class="note-info">ç®€è°±ï¼š{{currentNote.jianpu}}</text>
      <text class="note-info">æ–‡ä»¶åï¼š{{currentNote.fileName}}</text>
      <text class="note-info">å½“å‰ç´¢å¼•ï¼š{{currentNoteIndex + 1}} / {{totalCount}}</text>
    </view>

    <!-- äº”çº¿è°±æ˜¾ç¤ºåŒºåŸŸ -->
    <view class="staff-container" wx:if="{{currentNote}}">
      <staff-image 
        note="{{currentNote}}" 
        clef="{{currentNote.clef}}"
      />
    </view>

    <!-- ç›´æ¥å›¾ç‰‡æµ‹è¯• -->
    <view class="direct-image-test" wx:if="{{currentNote}}">
      <text class="section-title">ç›´æ¥å›¾ç‰‡æµ‹è¯•</text>
      <image 
        class="test-image" 
        src="{{testImagePath}}"
        mode="aspectFit"
        binderror="onImageError"
        bindload="onImageLoad"
      />
      <text class="image-path">è·¯å¾„ï¼š{{testImagePath}}</text>
    </view>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <view class="controls">
      <button class="btn btn-secondary" bindtap="prevNote">â† ä¸Šä¸€ä¸ª</button>
      <text class="control-info">{{currentNoteIndex + 1}} / {{totalCount}}</text>
      <button class="btn btn-secondary" bindtap="nextNote">ä¸‹ä¸€ä¸ª â†’</button>
    </view>

    <!-- è°ƒè¯•æŒ‰é’® -->
    <view class="debug-controls">
      <button class="btn btn-secondary debug-btn" bindtap="debugImageManager">æ‰“å°è°ƒè¯•ä¿¡æ¯</button>
      <button class="btn btn-secondary debug-btn" bindtap="checkCurrentImage">æ£€æŸ¥å½“å‰å›¾ç‰‡</button>
    </view>

    <!-- éŸ³ç¬¦åˆ—è¡¨ -->
    <view class="note-list">
      <text class="section-title">éŸ³ç¬¦åˆ—è¡¨ ({{currentClef === 'all' ? 'å…¨éƒ¨' : (currentClef === 'treble' ? 'é«˜éŸ³ç¬¦å·' : 'ä½éŸ³ç¬¦å·')}})</text>
      <view class="notes">
        <view 
          wx:for="{{filteredNotes}}" 
          wx:key="fileName"
          class="note-item {{currentNote && currentNote.fileName === item.fileName ? 'active' : ''}}"
          bindtap="selectNote"
          data-index="{{item.selectIndex}}"
        >
          <view class="note-name">{{item.name}}</view>
          <view class="note-clef">{{item.clef === 'treble' ? 'é«˜éŸ³' : 'ä½éŸ³'}}</view>
          <view class="note-position">{{item.position}}</view>
        </view>
      </view>
    </view>
  </view>
</view>