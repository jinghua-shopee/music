# 🎼 五线谱图片生成器使用说明

## 📝 概述

本脚本基于现有代码中的五线谱渲染方法，使用ABCJS库生成高低音PNG图片。

## 🎯 生成范围

### 高音符号 (Treble Clef)
- **范围**: 从下加3线到上加5线
- **音符**: A2 到 D6
- **数量**: 25张图片

### 低音符号 (Bass Clef)  
- **范围**: 从下加7线到上加3线
- **音符**: C1 到 C5
- **数量**: 26张图片

**总计**: 51张PNG图片

## 📏 图片规格

- **尺寸**: 500px × 500px
- **格式**: PNG-8 (压缩优化)
- **背景**: 白色
- **布局**: 完美水平居中，五线谱固定480px大小
- **清晰度**: 超高清晰度 (scale: 20.0)

## 🚀 使用步骤

### 1. 准备环境
确保项目根目录下有 `abcjs-basic-min.js` 文件（已存在）。

### 2. 运行生成器
```bash
# 使用浏览器打开生成器页面
open generate_staff_images.html
```

### 3. 操作界面
1. **开始生成所有图片** - 一键生成所有51张图片
2. **仅生成高音图片** - 只生成25张高音符号图片  
3. **仅生成低音图片** - 只生成26张低音符号图片
4. **清空日志** - 清理操作日志

### 4. 下载图片
- 图片会自动逐个下载到浏览器默认下载文件夹
- 文件命名规则：`{clef}_{note}_{position}.png`
  - 例如：`treble_C4_第2间.png`
  - 例如：`bass_G3_第3线.png`

## 📊 进度监控

- **实时进度条**: 显示生成进度百分比
- **状态指示器**: 每个音符旁边的绿点表示已生成
- **详细日志**: 显示每张图片的生成状态和时间
- **统计信息**: 显示总耗时和成功生成的图片数量

## 🎨 技术特点

### 渲染参数（极大scale + 强制居中）
```javascript
ABCJS.renderAbc(element, abcNotation, {
    scale: 20.0,             // 极大scale让五线谱巨大
    staffwidth: 150,         // 极紧凑宽度让音符集中
    paddingleft: 5,          // 极小边距
    paddingright: 5,         // 极小边距  
    paddingtop: 5,           // 极小边距
    paddingbottom: 5,        // 极小边距
    add_classes: true,
    responsive: "resize"
});
```

### 固定大小居中算法
```javascript
// Canvas变换实现完美居中
ctx.translate(outputSize / 2, outputSize / 2);  // 移动到画布中心

// 使用固定的五线谱目标尺寸，不随PNG尺寸变化
const fixedStaffSize = 480; // 五线谱固定为480px大小
const scale = Math.min(fixedStaffSize / svgWidth, fixedStaffSize / svgHeight);
ctx.scale(scale, scale);

// 从中心点绘制图片
ctx.drawImage(img, -svgWidth / 2, -svgHeight / 2, svgWidth, svgHeight);
```

### 音符定义格式
```javascript
// 高音符号示例
{ abc: "c'", name: "C5", position: "上加1线" }

// 低音符号示例  
{ abc: "C,,", name: "C3", position: "第1线" }
```

## 📁 输出文件夹

生成的图片会自动下载，建议创建一个专门的文件夹来整理：

```
staff_images/
├── treble_A2_下加3线.png
├── treble_B2_下加3线间.png
├── treble_C3_下加2线.png
├── ...
├── bass_C1_下加7线.png
├── bass_D1_下加7线间.png
├── bass_E1_下加6线.png
└── ...
```

## ⚠️ 注意事项

1. **浏览器兼容性**: 建议使用Chrome/Firefox等现代浏览器
2. **下载权限**: 确保浏览器允许多文件下载
3. **存储空间**: 每张图片约50-100KB，总计约5MB
4. **生成时间**: 完整生成约需要3-5分钟
5. **网络要求**: 需要加载ABCJS库（已本地化）

## 🔧 自定义选项

如需修改图片规格或范围，可编辑 `generate_staff_images.html` 中的：

- `trebleNotes` 数组 - 高音符号范围
- `bassNotes` 数组 - 低音符号范围  
- `renderNoteToImage` 函数中的尺寸参数

## 🎵 音符对照表

### 高音符号位置
| 位置 | 音符 | ABC记法 |
|------|------|---------|
| 下加3线 | A2 | A,, |
| 第5线 | A4 | a |
| 上加5线 | D6 | d'' |

### 低音符号位置  
| 位置 | 音符 | ABC记法 |
|------|------|---------|
| 下加7线 | C1 | C,,,, |
| 第5线 | D4 | D, |
| 上加3线 | C5 | c |

## 📞 使用帮助

如遇到问题，请检查：
1. ABCJS库是否正确加载
2. 浏览器控制台是否有错误信息
3. 下载权限是否开启
4. 网络连接是否正常 